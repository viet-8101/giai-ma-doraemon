<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·∫£i m√£ Doraemon</title>
    <link rel="icon" href="Doraenon_logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- reCAPTCHA v2 Invisible script - T·∫£i th∆∞ vi·ªán reCAPTCHA t·ª´ Google. -->
    <!-- 'defer' gi√∫p t·∫£i script kh√¥ng ch·∫∑n render HTML. -->
    <script src="https://www.google.com/recaptcha/api.js" defer></script>
    
    <style>
        /* CSS C∆† B·∫¢N V√Ä CHUNG */
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: url('doraemon-bg.jpg') no-repeat center center fixed; /* ƒê·ªïi 'doraemon-bg.jpg' th√†nh ·∫£nh n·ªÅn c·ªßa b·∫°n */
            background-size: cover;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* ƒê·∫£m b·∫£o ƒë·ªß chi·ªÅu cao */
            overflow: hidden; /* NgƒÉn cu·ªôn khi splash screen ƒëang ho·∫°t ƒë·ªông */
        }

        /* Giao di·ªán ch√≠nh c·ªßa ·ª©ng d·ª•ng */
        #mainContent {
            visibility: hidden; /* Ban ƒë·∫ßu ·∫©n giao di·ªán ch√≠nh */
            opacity: 0; /* Cho hi·ªáu ·ª©ng m·ªù d·∫ßn khi hi·ªán ra */
            transition: opacity 1s ease-in, visibility 1s ease-in; /* Th√™m transition cho visibility */
            flex-direction: column; /* ƒê·ªÉ cƒÉn gi·ªØa n·ªôi dung overlay */
            justify-content: center;
            align-items: center;
            width: 100%; /* Chi·∫øm to√†n b·ªô chi·ªÅu r·ªông ƒë·ªÉ cƒÉn gi·ªØa overlay */
            height: 100vh;
        }
        #mainContent.visible {
            visibility: visible; /* Hi·ªÉn th·ªã l·∫°i khi splash screen ·∫©n */
            opacity: 1;
        }

        .overlay {
            background: rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%; /* Responsive width */
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
            position: relative;
            box-sizing: border-box; /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m tƒÉng k√≠ch th∆∞·ªõc */
        }

        h1 {
            font-size: 2.4em;
            margin-bottom: 20px;
            color: white; /* ƒê·∫£m b·∫£o m√†u s·∫Øc hi·ªÉn th·ªã r√µ r√†ng */
        }

    textarea {
      width: 70%;
      height: 70px;
      margin-bottom: 20px;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 1em;
      resize: none;
    }

        .button-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng tr√™n m√†n h√¨nh nh·ªè */
            gap: 12px; /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
            margin-bottom: 20px;
        }

        button {
            padding: 10px 18px;
            font-size: 1em;
            background: linear-gradient(270deg, #00bfff, #1e90ff, #ff69b4, #00fa9a, #00bfff);
            background-size: 1000% 1000%;
            animation: gradientFlow 10s ease infinite;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            min-width: 180px;
            transition: transform 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        }
        button:hover {
            transform: scale(1.05);
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #output {
            margin-top: 20px;
            font-size: 1.2em;
            white-space: pre-wrap;
            min-height: 40px;
            color: white;
        }

        #messageBox {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.95em;
            min-height: 25px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #messageBox.show {
            opacity: 1;
        }

        /* Microphone Indicator */
        .mic-indicator {
            width: 50px;
            height: 50px;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }
        .mic-indicator svg {
            width: 100%;
            height: 100%;
            fill: #00bfff;
            animation: micWave 1s infinite ease-in-out;
        }
        @keyframes micWave {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        #micText {
            margin-top: 10px;
            font-style: italic;
            display: none; /* Hidden by default */
            color: #ccc;
        }

        /* Settings Panel */
        .settings-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            color: white;
            transition: transform 0.5s ease-out;
            z-index: 10;
            /* C√†i ƒë·∫∑t m·ªõi cho icon b√°nh rƒÉng */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px; /* K√≠ch th∆∞·ªõc icon */
            height: 40px;
            font-size: 2.2em; /* K√≠ch th∆∞·ªõc icon b√°nh rƒÉng */
        }

        .settings-toggle.rotate {
            animation: rotate 0.5s ease-out forwards;
        }
        .settings-toggle.rotate-back {
            animation: rotate-back 0.5s ease-out forwards;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(180deg); } }
        @keyframes rotate-back { from { transform: rotate(180deg); } to { transform: rotate(0deg); } }

        .settings-panel {
            display: none; /* Hidden by default */
            position: absolute;
            top: 65px; /* V·ªã tr√≠ d∆∞·ªõi n√∫t c√†i ƒë·∫∑t */
            right: 20px;
            background-color: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            flex-direction: column;
            gap: 10px;
            z-index: 9; /* D∆∞·ªõi n√∫t toggle */
            min-width: 150px;
        }
        .settings-panel label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1em;
            color: #ccc;
        }
        .settings-panel input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: #00bfff; /* M√†u checkbox */
        }
        .settings-panel button {
            background: linear-gradient(270deg, #00bfff, #1e90ff); /* Blueish gradient */
            color: white;
            padding: 10px;
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
            box-shadow: none; /* Remove default shadow for panel buttons */
            min-width: unset; /* Remove min-width from general button */
            margin-top: 5px; /* Add some space above buttons in settings */
        }
        .settings-panel button:hover {
            transform: none; /* No scale for panel buttons */
            background: linear-gradient(270deg, #1e90ff, #00bfff); /* Slightly darker */
        }

        /* Modal Styles */
        .modal {
            display: none; /* Ban ƒë·∫ßu ·∫©n modal ƒë·ªÉ kh√¥ng hi·ªán tr∆∞·ªõc giao di·ªán ch√≠nh */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            /* C√°c thu·ªôc t√≠nh quan tr·ªçng ƒë·ªÉ cƒÉn gi·ªØa n·ªôi dung */
            justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
            align-items: center;     /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
            animation: fadeInModal 0.3s ease-out;
        }
        .modal .close-btn {
            background-color: #f44336;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
            margin-top: 20px; /* Space from content */
        }
        .modal .close-btn:hover {
            background-color: #d32f2f;
        }

        #modalLichSu .modal-content {
            background-color: #222;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            width: 90%;
            max-width: 700px;
            max-height: 80vh; /* Gi·ªõi h·∫°n chi·ªÅu cao */
            overflow-y: auto; /* Cho ph√©p cu·ªôn */
            color: white;
            display: flex; /* D√πng flex ƒë·ªÉ d·ªÖ cƒÉn ch·ªânh n√∫t ƒë√≥ng */
            flex-direction: column;
            align-items: center; /* CƒÉn gi·ªØa n·ªôi dung v√† n√∫t ƒë√≥ng */
        }
        #lichSuNoiDung {
            width: 100%; /* Chi·∫øm to√†n b·ªô chi·ªÅu r·ªông c·ªßa modal-content */
            text-align: left;
        }
        #lichSuNoiDung .history-item {
            background-color: #333;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            word-break: break-word; /* ƒê√£ ƒë·ªïi t·ª´ break-all sang break-word ƒë·ªÉ tr√¥ng t·ª± nhi√™n h∆°n */
            border-left: 5px solid #00bfff; /* M√†u xanh n∆∞·ªõc bi·ªÉn */
            position: relative;
            padding-right: 40px; /* ƒê·ªß ch·ªó cho n√∫t x√≥a */
        }
        #lichSuNoiDung .delete-item-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #lichSuNoiDung .delete-item-btn:hover {
            background-color: #d32f2f;
        }

        /* Confirmation Modal Content Styles */
        /* ƒê·∫∑t c√°c style c·ªßa h·ªôp tho·∫°i x√°c nh·∫≠n v√†o #confirmModalContent (ph·∫ßn t·ª≠ con c·ªßa .modal) */
        #confirmModalContent {
            text-align: center;
            background: rgba(0, 0, 0, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.7);
            max-width: 350px;
            display: flex; /* ƒê·∫£m b·∫£o n·ªôi dung b√™n trong n√≥ c≈©ng l√† flex ƒë·ªÉ s·∫Øp x·∫øp c√°c n√∫t */
            flex-direction: column;
            gap: 20px;
        }
        #confirmModalContent p {
            font-size: 1.1em;
            margin: 0;
            color: white;
        }
        #confirmModalContent .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #confirmModalContent .confirm-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            min-width: 100px;
        }
        #confirmModalContent .confirm-buttons button.cancel-btn {
            background: #6c757d; /* Gray */
            color: white;
        }
        #confirmModalContent .confirm-buttons button.cancel-btn:hover {
            background: #5a6268;
        }
        #confirmModalContent .confirm-buttons button.continue-btn {
            background: #dc3545; /* Red */
            color: white;
        }
        #confirmModalContent .confirm-buttons button.continue-btn:hover {
            background: #c82333;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ======================================= */
        /* CSS CHO SPLASH SCREEN M·ªöI - ƒê√ÇY L√Ä PH·∫¶N QUAN TR·ªåNG NH·∫§T */
        /* ======================================= */

        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; /* Quan tr·ªçng ƒë·ªÉ c√°c ph·∫ßn t√°ch kh√¥ng t·∫°o thanh cu·ªôn */
            display: flex; /* ƒê·ªÉ cƒÉn gi·ªØa n·ªôi dung */
            justify-content: center;
            align-items: center;
            z-index: 10000; /* Lu√¥n n·∫±m tr√™n c√πng */
            /* N·ªÅn gradient cho m√†n h√¨nh ch√≠nh c·ªßa splash screen, s·∫Ω hi·ªÉn th·ªã sau khi blackScreenOverlay m·ªù ƒëi */
            background: linear-gradient(270deg, #00bfff, #1e90ff, #ff69b4, #00fa9a, #00bfff);
            background-size: 1000% 1000%;
            animation: gradientFlow 15s ease infinite; /* Gi·ªØ animation n·ªÅn */
        }

        /* M√†n h√¨nh ƒëen ban ƒë·∫ßu */
        #blackScreenOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 10002; /* Tr√™n t√™n, d∆∞·ªõi c√°c ph·∫ßn t√°ch */
            opacity: 1;
            animation: blackScreenFadeOut 2s linear forwards; /* M·ªù d·∫ßn trong 2s */
            animation-delay: 0s; /* B·∫Øt ƒë·∫ßu ngay l·∫≠p t·ª©c */
        }

        /* Container cho t√™n v√† subtitle */
        #myNameContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* CƒÉn gi·ªØa */
            z-index: 10001; /* D∆∞·ªõi m√†n h√¨nh ƒëen v√† c√°c ph·∫ßn t√°ch */
            opacity: 0; /* Ban ƒë·∫ßu ·∫©n */
            color: white;
            font-family: 'Arial Black', sans-serif; /* Font n·ªïi b·∫≠t h∆°n */
            font-size: 4.5em; /* K√≠ch th∆∞·ªõc to h∆°n */
            font-weight: bold;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            /* Animation: hi·ªán ra (2-4s) v√† m·ªù ƒëi (4-6s) */
            animation:
                myNameFadeInScale 2s ease-out 2s forwards,
                myNameFadeOutScale 2s ease-in 4s forwards;
            white-space: nowrap; /* Gi·ªØ t√™n tr√™n m·ªôt d√≤ng n·∫øu c√≥ th·ªÉ */
            padding: 0 10px; /* ƒê·∫£m b·∫£o t√™n kh√¥ng b·ªã tr√†n ra ngo√†i m√†n h√¨nh qu√° s√°t l·ªÅ */
            box-sizing: border-box;
            text-align: center; /* CƒÉn gi·ªØa n·ªôi dung b√™n trong */
        }
        #myNameContainer .my-name {
            display: inline-block; /* ƒê·ªÉ √°p d·ª•ng transform v√† animation t·ªët h∆°n */
        }
        
        /* CSS SUBTITLE */
        .intro-subtitle {
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
            font-size: 0.3em; /* K√≠ch th∆∞·ªõc t∆∞∆°ng ƒë·ªëi so v·ªõi t√™n */
            font-weight: normal;
            display: block; /* Hi·ªÉn th·ªã ·ªü d√≤ng m·ªõi */
            margin-top: 15px; /* Kho·∫£ng c√°ch v·ªõi t√™n */
            color: #f0f8ff; /* M√†u tr·∫Øng s√°ng (AliceBlue) */
            letter-spacing: 1px;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
            /* Animation cho subtitle */
            opacity: 0;
            animation: subtitleFadeIn 2s ease-out 2.5s forwards, /* Hi·ªán ra sau t√™n m·ªôt ch√∫t */
                         subtitleFadeOut 2s ease-in 4s forwards; /* M·ªù ƒëi c√πng l√∫c v·ªõi t√™n */
        }
        
        /* CSS CHO N√öT SKIP */
        #skipButton {
            position: absolute;
            bottom: 30px;
            right: 30px;
            padding: 10px 25px;
            font-size: 1em;
            font-weight: bold;
            color: white;
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            z-index: 10004; /* N·∫±m tr√™n t·∫•t c·∫£ c√°c l·ªõp kh√°c c·ªßa splash screen */
            opacity: 0; /* Ban ƒë·∫ßu ·∫©n */
            visibility: hidden; /* ·∫®n ho√†n to√†n */
            transition: all 0.4s ease-in-out;
            animation: skipButtonFadeIn 1s ease-out 2s forwards; /* Hi·ªán ra sau 2 gi√¢y */
        }
        #skipButton:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* C√°c ph·∫ßn chia */
        .split-part {
            position: absolute;
            width: 50vw; /* Chi·∫øm 50% viewport width */
            height: 50vh; /* Chi·∫øm 50% viewport height */
            opacity: 0; /* Ban ƒë·∫ßu ·∫©n */
            /* K·∫ø th·ª´a n·ªÅn gradient t·ª´ #splashScreen */
            background: linear-gradient(270deg, #00bfff, #1e90ff, #ff69b4, #00fa9a, #00bfff);
            background-size: 1000% 1000%;
            animation: gradientFlow 15s ease infinite; /* Gi·ªØ animation n·ªÅn */
            z-index: 10003; /* N·∫±m tr√™n c√πng */
        }

        /* V·ªã tr√≠ ban ƒë·∫ßu v√† animation di chuy·ªÉn ri√™ng c·ªßa t·ª´ng ph·∫ßn */
        .split-part.top-left {
            top: 0; left: 0;
            animation:
                splitAppear 0s linear 6s forwards, /* Xu·∫•t hi·ªán t·∫°i gi√¢y 6 */
                splitMoveTopLeft 1s ease-out 6s forwards, /* Di chuy·ªÉn ra t·ª´ gi√¢y 6-7 */
                finalFadeOut 3s linear 7s forwards; /* M·ªù d·∫ßn t·ª´ gi√¢y 7-10 */
        }
        .split-part.top-right {
            top: 0; left: 50vw;
            animation:
                splitAppear 0s linear 6s forwards,
                splitMoveTopRight 1s ease-out 6s forwards,
                finalFadeOut 3s linear 7s forwards;
        }
        .split-part.bottom-left {
            top: 50vh; left: 0;
            animation:
                splitAppear 0s linear 6s forwards,
                splitMoveBottomLeft 1s ease-out 6s forwards,
                finalFadeOut 3s linear 7s forwards;
        }
        .split-part.bottom-right {
            top: 50vh; left: 50vw;
            animation:
                splitAppear 0s linear 6s forwards,
                splitMoveBottomRight 1s ease-out 6s forwards,
                finalFadeOut 3s linear 7s forwards;
        }

        /* ================== */
        /* ƒê·ªäNH NGHƒ®A KEYFRAMES */
        /* ================== */

        /* N·ªÅn gradient */
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* M√†n h√¨nh ƒëen m·ªù d·∫ßn (0-2s) */
        @keyframes blackScreenFadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        /* T√™n hi·ªán ra v√† ph√≥ng to (2-4s) */
        @keyframes myNameFadeInScale {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* T√™n m·ªù d·∫ßn v√† thu nh·ªè (4-6s) */
        @keyframes myNameFadeOutScale {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); visibility: hidden; }
        }
        
        /* KEYFRAMES cho SUBTITLE */
        @keyframes subtitleFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes subtitleFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* KEYFRAME cho N√öT SKIP */
        @keyframes skipButtonFadeIn {
            to {
                opacity: 1;
                visibility: visible;
            }
        }

        /* C√°c ph·∫ßn chia xu·∫•t hi·ªán (t·∫°i gi√¢y 6) */
        @keyframes splitAppear {
            to { opacity: 1; }
        }

        /* C√°c ph·∫ßn chia di chuy·ªÉn ra (6-7s) */
        @keyframes splitMoveTopLeft {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, -100%); } /* Di chuy·ªÉn l√™n tr√°i */
        }
        @keyframes splitMoveTopRight {
            0% { transform: translate(0, 0); }
            100% { transform: translate(100%, -100%); } /* Di chuy·ªÉn l√™n ph·∫£i */
        }
        @keyframes splitMoveBottomLeft {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 100%); } /* Di chuy·ªÉn xu·ªëng tr√°i */
        }
        @keyframes splitMoveBottomRight {
            0% { transform: translate(0, 0); }
            100% { transform: translate(100%, 100%); } /* Di chuy·ªÉn xu·ªëng ph·∫£i */
        }

        /* M·ªù d·∫ßn cu·ªëi c√πng c·ªßa c√°c ph·∫ßn t√°ch (7-10s) */
        @keyframes finalFadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            button {
                padding: 10px 15px; /* Gi·∫£m padding ngang cho n√∫t */
                font-size: 0.95em; /* Gi·∫£m font size cho n√∫t */
                min-width: 150px; /* ƒêi·ªÅu ch·ªânh min-width ƒë·ªÉ tr√°nh tr√†n */
            }
            .overlay {
                padding: 25px 15px; /* Gi·∫£m padding ngang c·ªßa overlay */
            }
            #myNameContainer {
                font-size: 3em; /* Nh·ªè h∆°n tr√™n di ƒë·ªông */
                word-wrap: break-word; /* Cho ph√©p ng·∫Øt t·ª´ n·∫øu t√™n qu√° d√†i */
                white-space: normal; /* Cho ph√©p xu·ªëng d√≤ng */
                max-width: 90vw; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông ƒë·ªÉ kh√¥ng tr√†n ra ngo√†i */
            }
            .intro-subtitle {
                font-size: 0.25em; /* Gi·∫£m size subtitle tr√™n mobile */
            }
            #skipButton {
                font-size: 0.9em;
                padding: 8px 20px;
                bottom: 20px;
                right: 20px;
            }
            .settings-panel {
                right: 15px; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ panel */
                min-width: 130px;
            }
            .settings-panel button {
                font-size: 0.85em;
            }
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            textarea {
                height: 80px;
            }
            button {
                padding: 8px 12px; /* Gi·∫£m padding nh·ªè h∆°n n·ªØa */
                font-size: 0.85em; /* Gi·∫£m font size nh·ªè h∆°n n·ªØa */
                min-width: 130px; /* ƒêi·ªÅu ch·ªânh min-width ch·∫∑t ch·∫Ω h∆°n */
            }
            .overlay {
                padding: 15px 10px; /* Gi·∫£m padding r·∫•t nhi·ªÅu */
            }
            #myNameContainer {
                font-size: 1.8em; /* Nh·ªè h∆°n n·ªØa tr√™n di ƒë·ªông */
            }
            .intro-subtitle {
                font-size: 0.3em; /* TƒÉng l·∫°i m·ªôt ch√∫t cho c√¢n ƒë·ªëi */
            }
            .button-group {
                gap: 8px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
            }
        }
    </style>
</head>
<body>
    <div id="splashScreen">
        <div id="blackScreenOverlay"></div>
        <div id="myNameContainer">
            <span class="my-name">NGUY·ªÑN ƒê·∫ÆC HO√ÄNG VI·ªÜT</span>
            <span class="intro-subtitle">‚ú® Chu·∫©n b·ªã kh√°m ph√° th·∫ø gi·ªõi k·ª≥ di·ªáu c·ªßa Doraemon... ‚ú®</span>
        </div>
        <div class="split-part top-left"></div>
        <div class="split-part top-right"></div>
        <div class="split-part bottom-left"></div>
        <div class="split-part bottom-right"></div>
        <button id="skipButton" onclick="skipIntro()">Skip</button>
    </div>

    <div id="mainContent">
        <div class="overlay">
            <h1> üîç  Gi·∫£i m√£ Doraemon</h1>
            <textarea id="input" placeholder="Nh·∫≠p m√£ troll ·ªü ƒë√¢y..." onkeydown="chanEnter(event)"></textarea>
            <div class="button-group">
                <button onclick="giaiMa()">üß† Gi·∫£i m√£ Doraemon</button>
                <button onclick="saoChep()"> üìã  Copy k·∫øt qu·∫£</button>
                <button onclick="startDictation()"> üé§  Nh·∫≠n di·ªán gi·ªçng n√≥i</button>
            </div>
            <div id="output"></div>
            <div id="messageBox"></div>
            <!-- reCAPTCHA container - ƒê√¢y l√† n∆°i reCAPTCHA v2 Invisible s·∫Ω ƒë∆∞·ª£c render. -->
            <!-- data-sitekey ph·∫£i l√† Site Key (Public Key) c·ªßa b·∫°n. -->
            <!-- data-callback s·∫Ω g·ªçi h√†m onRecaptchaSuccess sau khi x√°c th·ª±c th√†nh c√¥ng. -->
            <!-- data-size="invisible" l√† ƒë·ªÉ reCAPTCHA ho·∫°t ƒë·ªông ·∫©n. -->
            <div id="recaptcha-container"
                 class="g-recaptcha"
                 data-sitekey="6LfWt3grAAAAAMe7Q_tyRVpCUMzBLhBYzssjXn2I"
                 data-callback="onRecaptchaSuccess"
                 data-size="invisible">
            </div>
            <div class="mic-indicator" id="micIndicator">
                <svg viewBox="0 0 24 24">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3zm5 8v3a5 5 0 0 1-10 0V9H5v3a7 7 0 0 0 6 6.92V22h2v-3.08A7 7 0 0 0 19 12V9z" />
                </svg>
            </div>
            <div id="micText">üéôÔ∏è ƒêang l·∫Øng nghe...</div>
            <div class="settings-toggle" onclick="toggleSettings()">
                <i class="fas fa-cog"></i>
            </div>
            <div class="settings-panel" id="settingsPanel">
                <button id="toggleSoundButton" onclick="toggleAudio()">ÔøΩ B·∫≠t/T·∫Øt √Çm thanh n·ªÅn</button>
                <button onclick="playAudio('giao-huong')">üéµ B·∫£n giao h∆∞·ªüng ƒë·ªãa c·∫ßu</button>
                <button onclick="playAudio('com-ngon')">üé∂ B·ªØa c∆°m ngon l√†nh</button>
                <button onclick="openLichSu()"> üìú  Xem l·ªãch s·ª≠</button>
                <button onclick="clearAllHistory()">üóëÔ∏è X√≥a l·ªãch s·ª≠</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modalLichSu" tabindex="-1">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLichSu()">ƒê√≥ng</button>
            <div id="lichSuNoiDung"></div>
        </div>
    </div>

    <div class="modal" id="confirmModal" tabindex="-1">
        <div id="confirmModalContent">
            <p id="confirmMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ kh√¥ng?</p>
            <div class="confirm-buttons">
                <button class="cancel-btn" onclick="cancelConfirmation()">Quay l·∫°i</button>
                <button class="continue-btn" onclick="proceedConfirmation()">Ti·∫øp t·ª•c</button>
            </div>
        </div>
    </div>

    <audio id="myAudio" loop muted>
        <source src="https://media.vocaroo.com/mp3/1mrXpaxv1jUB" type="audio/mpeg">
    </audio>
    <audio id="typeSound" preload="auto">
        <source src="https://cdn.pixabay.com/audio/2023/03/01/audio_2a802b1f48.mp3" type="audio/mpeg">
    </audio>
    <audio id="com-ngon" preload="auto">
        <source src="https://media.vocaroo.com/mp3/1883Jz7Qz18d" type="audio/mpeg">
    </audio>
    <audio id="giao-huong" preload="auto">
        <source src="https://media.vocaroo.com/mp3/1mrXpaxv1jUB" type="audio/mpeg">
    </audio>

    <script>
        // T·ª´ ƒëi·ªÉn Doraemon ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ho√†n to√†n sang SERVER.
        // const tuDienDoraemon = { ... }; // ƒê√£ lo·∫°i b·ªè d√≤ng n√†y

        let lastDecodedResult = "";
        let audioPlayedFirstTime = false; // Bi·∫øn c·ªù ƒë·ªÉ ki·ªÉm tra xem nh·∫°c ƒë√£ ph√°t l·∫ßn ƒë·∫ßu ch∆∞a
        let pendingDeleteIndex = -1; // Bi·∫øn ƒë·ªÉ l∆∞u tr·ªØ ch·ªâ s·ªë c·ªßa m·ª•c s·∫Ω x√≥a
        let isDeletingAll = false; // Bi·∫øn c·ªù ƒë·ªÉ bi·∫øt ƒëang x√≥a to√†n b·ªô hay x√≥a t·ª´ng m·ª•c
        let splashTimer = null; // Bi·∫øn ƒë·ªÉ qu·∫£n l√Ω setTimeout c·ªßa splash screen
        let recaptchaWidgetId; // Bi·∫øn ƒë·ªÉ l∆∞u ID c·ªßa widget reCAPTCHA

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o ng·∫Øn tr√™n giao di·ªán ng∆∞·ªùi d√πng
        function showMessage(msg, type = 'info') {
            const msgBox = document.getElementById('messageBox');
            msgBox.textContent = msg; // S·ª≠ d·ª•ng textContent ƒë·ªÉ ch·ªëng XSS khi hi·ªÉn th·ªã th√¥ng b√°o
            msgBox.className = 'show';
            if (type === 'error') {
                msgBox.style.backgroundColor = 'rgba(220, 20, 60, 0.8)';
            } else if (type === 'success') {
                msgBox.style.backgroundColor = 'rgba(60, 179, 113, 0.8)';
            } else {
                msgBox.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            }
            if (msgBox.timer) clearTimeout(msgBox.timer);
            msgBox.timer = setTimeout(() => {
                msgBox.className = '';
                msgBox.textContent = '';
            }, 3000);
        }

        // H√†m escapeRegExp kh√¥ng c√≤n c·∫ßn thi·∫øt ·ªü frontend v√¨ logic gi·∫£i m√£ ƒë√£ chuy·ªÉn ho√†n to√†n sang backend.
        // function escapeRegExp(str) {
        //     return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
        // }

        // H√†m ch√≠nh ƒë·ªÉ gi·∫£i m√£ n·ªôi dung nh·∫≠p v√†o
        // Logic gi·∫£i m√£ v√† x√°c th·ª±c reCAPTCHA gi·ªù ƒë√¢y ho√†n to√†n do SERVER x·ª≠ l√Ω.
        function giaiMa() {
            const inputElement = document.getElementById("input");
            const outputElement = document.getElementById("output");
            const input = inputElement.value.trim().toLowerCase();

            if (!input) {
                showMessage(" ‚ö†Ô∏è  B·∫°n ch∆∞a nh·∫≠p g√¨ c·∫£!", "error");
                lastDecodedResult = "";
                outputElement.textContent = ""; // X√≥a k·∫øt qu·∫£ c≈© n·∫øu c√≥
                return;
            }

            showMessage("ƒêang x√°c th·ª±c, vui l√≤ng ch·ªù...", "info");
            // K√≠ch ho·∫°t reCAPTCHA. Khi x√°c th·ª±c th√†nh c√¥ng, onRecaptchaSuccess s·∫Ω ƒë∆∞·ª£c g·ªçi.
            // grecaptcha.execute() s·∫Ω k√≠ch ho·∫°t reCAPTCHA v2 Invisible.
            grecaptcha.execute(recaptchaWidgetId);
        }

        // H√†m ƒë∆∞·ª£c Google g·ªçi khi reCAPTCHA API t·∫£i xong
        window.onloadCallback = function() {
            console.log("reCAPTCHA API ƒë√£ s·∫µn s√†ng ƒë·ªÉ s·ª≠ d·ª•ng.");
            if (document.getElementById('recaptcha-container')) {
                // Kh·ªüi t·∫°o reCAPTCHA widget v√¥ h√¨nh.
                // 'sitekey' l√† kh√≥a c√¥ng khai b·∫°n nh·∫≠n ƒë∆∞·ª£c t·ª´ Google.
                // 'callback' l√† h√†m s·∫Ω ƒë∆∞·ª£c g·ªçi khi reCAPTCHA x√°c th·ª±c th√†nh c√¥ng.
                recaptchaWidgetId = grecaptcha.render('recaptcha-container', {
                    'sitekey': '6LfWt3grAAAAAMe7Q_tyRVpCUMzBLhBYzssjXn2I', // reCAPTCHA site key c·ªßa b·∫°n (ƒë·∫£m b·∫£o ƒë√¢y l√† V2 Invisible key)
                    'callback': onRecaptchaSuccess,
                    'size': 'invisible' // Ch·∫ø ƒë·ªô v√¥ h√¨nh
                });
            }
        };

        // H√†m ƒë∆∞·ª£c g·ªçi sau khi reCAPTCHA x√°c th·ª±c th√†nh c√¥ng v√† tr·∫£ v·ªÅ token
        async function onRecaptchaSuccess(token) {
            showMessage("‚úÖ X√°c th·ª±c th√†nh c√¥ng! ƒêang g·ª≠i ƒë·∫øn m√°y ch·ªß...", "success");
            const userInput = document.getElementById("input").value.trim();
            const originalInput = userInput; // L∆∞u l·∫°i input g·ªëc ƒë·ªÉ l∆∞u l·ªãch s·ª≠

            try {
                // G·ª≠i y√™u c·∫ßu (g·ªìm input v√† token) ƒë·∫øn backend c·ªßa ch√∫ng ta
                // !!! R·∫§T QUAN TR·ªåNG: ƒê·∫¢M B·∫¢O URL N√ÄY TR·ªé ƒê·∫æN SERVER BACKEND C·ª¶A B·∫†N !!!
                // V√≠ d·ª•: 'https://your-doraemon-backend.onrender.com/giai-ma'
                const response = await fetch('https://doraemon-backend.onrender.com/giai-ma', { // ƒê·ªãa ch·ªâ server backend c·ªßa b·∫°n
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userInput: userInput,
                        recaptchaToken: token
                    }),
                });

                const data = await response.json();

                if (!response.ok) {
                    // Hi·ªÉn th·ªã l·ªói n·∫øu server tr·∫£ v·ªÅ l·ªói (v√≠ d·ª•: token reCAPTCHA sai, l·ªói logic backend)
                    throw new Error(data.error || 'L·ªói kh√¥ng x√°c ƒë·ªãnh t·ª´ m√°y ch·ªß');
                }

                // N·∫øu server tr·∫£ v·ªÅ l·ªói kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a
                if (data.status === 'notFound') { // Gi·∫£ s·ª≠ server tr·∫£ v·ªÅ status n√†y n·∫øu kh√¥ng t√¨m th·∫•y
                    goChuTungKyTu(" ‚ùì  Kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a ph√π h·ª£p.", "output", 30);
                    lastDecodedResult = "";
                } else {
                    // Hi·ªÉn th·ªã k·∫øt qu·∫£ th√†nh c√¥ng t·ª´ server
                    goChuTungKyTu(" ‚û°Ô∏è  K·∫øt qu·∫£: " + data.ketQua, "output", 30);
                    lastDecodedResult = data.ketQua;

                    // L∆∞u l·ªãch s·ª≠ v√†o LocalStorage (v·∫´n ch·∫°y ·ªü frontend)
                    // ƒê·∫£m b·∫£o d·ªØ li·ªáu l∆∞u tr·ªØ l√† s·∫°ch (ƒë∆∞·ª£c l·ªçc t·ª´ server)
                    // ho·∫∑c kh√¥ng ch·ª©a HTML/script n·∫øu b·∫°n mu·ªën d√πng innerHTML ƒë·ªÉ hi·ªÉn th·ªã sau n√†y.
                    // Hi·ªán t·∫°i, d·ªØ li·ªáu ƒë∆∞·ª£c hi·ªÉn th·ªã b·∫±ng textContent n√™n kh√¥ng c√≥ nguy c∆° XSS ·ªü ƒë√¢y.
                    const lichSu = JSON.parse(localStorage.getItem("lichSuDoraemon") || "[]");
                    lichSu.unshift({
                        input: originalInput, // Input g·ªëc
                        output: data.ketQua, // K·∫øt qu·∫£ t·ª´ server
                        timestamp: new Date().toLocaleString('vi-VN')
                    });
                    localStorage.setItem("lichSuDoraemon", JSON.stringify(lichSu.slice(0, 20))); // Gi·ªõi h·∫°n 20 m·ª•c
                }

            } catch (error) {
                console.error('ƒê√£ c√≥ l·ªói x·∫£y ra:', error);
                showMessage(`‚ùå L·ªói: ${error.message}`, "error");
            } finally {
                // Reset reCAPTCHA ƒë·ªÉ s·∫µn s√†ng cho l·∫ßn gi·∫£i m√£ ti·∫øp theo
                grecaptcha.reset(recaptchaWidgetId);
            }
        }
        
        // H√†m n√†y kh√¥ng c·∫ßn thay ƒë·ªïi, ch·∫°y ho√†n to√†n ·ªü client
        function goChuTungKyTu(text, elementId, speed) {
            const el = document.getElementById(elementId);
            const sound = document.getElementById("typeSound");
            // Stop any ongoing typing animation and clear content
            if (el.typingTimer) clearTimeout(el.typingTimer);
            el.textContent = "";

            let index = 0;
            function type() {
                if (index < text.length) {
                    el.textContent += text.charAt(index);
                    // Only play sound if not muted
                    if (!sound.muted) {
                        try {
                            sound.pause();
                            sound.currentTime = 0;
                            sound.play();
                        } catch (e) {
                            console.error("L·ªói khi ph√°t √¢m thanh:", e);
                        }
                    }
                    el.typingTimer = setTimeout(type, speed);
                    index++;
                } else {
                    // Ensure sound is stopped after typing is complete
                    sound.pause();
                    sound.currentTime = 0;
                }
            }
            type();
        }

        // H√†m sao ch√©p k·∫øt qu·∫£ ƒë√£ gi·∫£i m√£ v√†o clipboard
        function saoChep() {
            if (!lastDecodedResult) {
                showMessage(" ‚ö†Ô∏è  Ch∆∞a c√≥ k·∫øt qu·∫£ gi·∫£i m√£ ƒë·ªÉ sao ch√©p!", "error");
                return;
            }
            navigator.clipboard.writeText(lastDecodedResult).then(() => {
                showMessage(" üìã  ƒê√£ sao ch√©p k·∫øt qu·∫£!", "success");
            }).catch(err => {
                console.error('Kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n: ', err);
                showMessage('C√≥ l·ªói x·∫£y ra khi sao ch√©p. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c sao ch√©p th·ªß c√¥ng.', "error");
            });
        }

        // Kh·ªüi t·∫°o nh·∫≠n di·ªán gi·ªçng n√≥i n·∫øu tr√¨nh duy·ªát h·ªó tr·ª£
        let recognition;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'vi-VN'; // Ng√¥n ng·ªØ ti·∫øng Vi·ªát
            recognition.interimResults = false; // Kh√¥ng tr·∫£ v·ªÅ k·∫øt qu·∫£ t·∫°m th·ªùi
            recognition.maxAlternatives = 1; // Ch·ªâ l·∫•y m·ªôt k·∫øt qu·∫£ t·ªët nh·∫•t

            function startDictation() {
                showMessage("üéôÔ∏è ƒêang l·∫Øng nghe...", "info");
                document.getElementById("micIndicator").style.display = "block";
                document.getElementById("micText").style.display = "block";
                
                // **KH·∫ÆC PH·ª§C L·ªñI: ƒê·∫£m b·∫£o ch·ªâ g·ªçi start() khi recognition ch∆∞a b·∫Øt ƒë·∫ßu**
                if (recognition.recognizing) {
                    console.warn("SpeechRecognition ƒë√£ b·∫Øt ƒë·∫ßu. D·ª´ng v√† kh·ªüi ƒë·ªông l·∫°i.");
                    recognition.stop(); // D·ª´ng n·∫øu ƒë√£ ch·∫°y
                }
                recognition.start();

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById("input").value = transcript;
                    document.getElementById("micIndicator").style.display = "none";
                    document.getElementById("micText").style.display = "none";
                    showMessage(" ‚úÖ  Nh·∫≠n di·ªán gi·ªçng n√≥i ho√†n t·∫•t.", "success");
                    // Sau khi nh·∫≠n di·ªán xong, t·ª± ƒë·ªông g·ªçi h√†m gi·∫£i m√£
                    giaiMa();
                };

                recognition.onerror = function(event) {
                    console.error("L·ªói nh·∫≠n di·ªán gi·ªçng n√≥i:", event.error);
                    showMessage(" ‚ö†Ô∏è  Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c, th·ª≠ l·∫°i. L·ªói: " + event.error, "error");
                    document.getElementById("micIndicator").style.display = "none";
                    document.getElementById("micText").style.display = "none";
                };

                recognition.onend = function() {
                    document.getElementById("micIndicator").style.display = "none";
                    document.getElementById("micText").style.display = "none";
                };
            }
        } else {
            // H√†m thay th·∫ø n·∫øu tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i
            function startDictation() {
                showMessage(" ‚ö†Ô∏è  Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i (Ch·ªâ ho·∫°t ƒë·ªông t·ªët tr√™n Chrome).", "error");
            }
        }

        // Ch·∫∑n ph√≠m Enter trong textarea v√† thay b·∫±ng g·ªçi h√†m gi·∫£i m√£
        function chanEnter(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                giaiMa();
            }
        }

        // Ch·ª©c nƒÉng b·∫≠t/t·∫Øt b·∫£ng c√†i ƒë·∫∑t (b√°nh rƒÉng)
        function toggleSettings() {
            const panel = document.getElementById("settingsPanel");
            const toggleButton = document.querySelector(".settings-toggle");
            if (panel.style.display === "flex") {
                panel.style.display = "none";
                toggleButton.classList.remove("rotate");
                toggleButton.classList.add("rotate-back");
            }
            else {
                panel.style.display = "flex";
                toggleButton.classList.remove("rotate-back");
                toggleButton.classList.add("rotate");
            }
        }

        // Ch·ª©c nƒÉng b·∫≠t/t·∫Øt √¢m thanh t·ªïng th·ªÉ
        function toggleAudio() {
            const muted = document.getElementById("toggleSound").checked;
            document.getElementById("myAudio").muted = muted;
            document.getElementById("typeSound").muted = muted;
            document.getElementById("com-ngon").muted = muted;
            document.getElementById("giao-huong").muted = muted;
            localStorage.setItem("doraemonSoundMuted", muted);

            // N·∫øu ng∆∞·ªùi d√πng b·∫≠t √¢m thanh v√† ch∆∞a ph√°t l·∫ßn n√†o, th·ª≠ ph√°t l·∫°i
            if (!muted && !audioPlayedFirstTime) {
                document.getElementById("myAudio").play().catch(error => {
                    console.log("L·ªói khi ph√°t nh·∫°c n·ªÅn t·ª± ƒë·ªông (sau khi b·ªè t·∫Øt ti·∫øng):", error);
                });
                audioPlayedFirstTime = true; // ƒê√°nh d·∫•u ƒë√£ c·ªë g·∫Øng ph√°t
            }
        }

        // H√†m ph√°t c√°c b·∫£n nh·∫°c c·ª• th·ªÉ t·ª´ c√†i ƒë·∫∑t
        function playAudio(audioId) {
            const audio = document.getElementById(audioId);
            // D·ª´ng v√† reset c√°c audio kh√°c ƒëang ph√°t
            ['myAudio', 'typeSound', 'com-ngon', 'giao-huong'].forEach(id => {
                const otherAudio = document.getElementById(id);
                if (otherAudio && otherAudio !== audio) {
                    otherAudio.pause();
                    otherAudio.currentTime = 0;
                }
            });

            if (audio) {
                audio.loop = true; // ƒê·∫∑t √¢m thanh l·∫∑p l·∫°i
                if (audio.paused) {
                    audio.play().catch(error => {
                        console.error("Error playing audio:", error);
                        showMessage("‚ö†Ô∏è Kh√¥ng th·ªÉ ph√°t √¢m thanh. Vui l√≤ng t∆∞∆°ng t√°c trang tr∆∞·ªõc.", "error");
                    });
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                }
            }
        }

        // H√†m m·ªü modal l·ªãch s·ª≠ gi·∫£i m√£
        function openLichSu() {
            const lichSu = JSON.parse(localStorage.getItem("lichSuDoraemon") || "[]");
            const box = document.getElementById("lichSuNoiDung");

            box.innerHTML = ''; // X√≥a n·ªôi dung c≈©
            if (lichSu.length === 0) {
                box.innerHTML = '<p style="text-align: center; color: #ccc;"><i>Ch∆∞a c√≥ l·ªãch s·ª≠.</i></p>';
            } else {
                lichSu.forEach((item, idx) => {
                    const div = document.createElement('div');
                    div.classList.add('history-item');

                    // KH·∫ÆC PH·ª§C B·∫¢O M·∫¨T: Chuy·ªÉn sang s·ª≠ d·ª•ng textContent ho·∫∑c t·∫°o TextNode
                    // ƒë·ªÉ ngƒÉn ng·ª´a XSS khi hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ localStorage.
                    
                    const timestampSpan = document.createElement('strong');
                    timestampSpan.textContent = `(${item.timestamp})`;

                    const inputContent = document.createTextNode(item.input);
                    const arrowText = document.createTextNode(' ‚û°Ô∏è ');
                    const outputContent = document.createTextNode(item.output);

                    div.appendChild(timestampSpan);
                    div.appendChild(document.createElement('br')); // Th√™m th·∫ª <br> ƒë·ªÉ xu·ªëng d√≤ng
                    div.appendChild(inputContent);
                    div.appendChild(arrowText);
                    div.appendChild(outputContent);
                    // H·∫æT PH·∫¶N KH·∫ÆC PH·ª§C B·∫¢O M·∫¨T

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = ' ‚ùå ';
                    deleteButton.classList.add('delete-item-btn');
                    deleteButton.onclick = (event) => {
                        event.stopPropagation(); // NgƒÉn s·ª± ki·ªán click lan ra g√¢y ƒë√≥ng modal
                        showConfirmDeleteOne(idx); // Hi·ªÉn th·ªã x√°c nh·∫≠n x√≥a 1 m·ª•c
                    };
                    div.appendChild(deleteButton);
                    box.appendChild(div);
                });
            }
            document.getElementById("modalLichSu").style.display = "flex"; // Hi·ªÉn th·ªã modal
        }

        // H√†m ƒë√≥ng modal l·ªãch s·ª≠
        function closeLichSu() {
            document.getElementById("modalLichSu").style.display = "none";
        }

        // Hi·ªÉn th·ªã h·ªôp tho·∫°i x√°c nh·∫≠n khi x√≥a m·ªôt m·ª•c l·ªãch s·ª≠
        function showConfirmDeleteOne(index) {
            pendingDeleteIndex = index;
            isDeletingAll = false; // ƒê·∫£m b·∫£o ƒë√¢y l√† x√≥a m·ªôt m·ª•c
            document.getElementById("confirmMessage").textContent = "B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·ª•c n√†y kh·ªèi l·ªãch s·ª≠?";
            document.getElementById("confirmModal").style.display = "flex"; // Hi·ªán modal x√°c nh·∫≠n
        }
        
        // H√†m hi·ªÉn th·ªã h·ªôp tho·∫°i x√°c nh·∫≠n tr∆∞·ªõc khi x√≥a to√†n b·ªô l·ªãch s·ª≠.
        function clearAllHistory() {
            const lichSu = JSON.parse(localStorage.getItem("lichSuDoraemon") || "[]");
            if (lichSu.length === 0) {
                showMessage("üìú L·ªãch s·ª≠ ƒëang tr·ªëng.", 'info');
                return;
            }
            isDeletingAll = true;
            pendingDeleteIndex = -1; // ƒê·∫£m b·∫£o kh√¥ng x√≥a nh·∫ßm m·ª•c ƒë∆°n l·∫ª
            document.getElementById("confirmMessage").textContent = "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ kh√¥ng?";
            document.getElementById("confirmModal").style.display = "flex";
        }

        // X·ª≠ l√Ω x√°c nh·∫≠n x√≥a (m·ªôt m·ª•c ho·∫∑c to√†n b·ªô)
        function proceedConfirmation() {
            if (isDeletingAll) {
                localStorage.removeItem("lichSuDoraemon");
                showMessage("üóëÔ∏è ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠!", "success");
                closeLichSu(); // ƒê√≥ng modal l·ªãch s·ª≠ sau khi x√≥a
            } else if (pendingDeleteIndex !== -1) {
                const lichSu = JSON.parse(localStorage.getItem("lichSuDoraemon") || "[]");
                lichSu.splice(pendingDeleteIndex, 1);
                localStorage.setItem("lichSuDoraemon", JSON.stringify(lichSu));
                showMessage("üóëÔ∏è ƒê√£ x√≥a m·ª•c kh·ªèi l·ªãch s·ª≠!", "success");
                pendingDeleteIndex = -1;
            }
            document.getElementById("confirmModal").style.display = "none"; // ·∫®n modal x√°c nh·∫≠n
            openLichSu(); // C·∫≠p nh·∫≠t l·∫°i giao di·ªán l·ªãch s·ª≠
        }

        // H·ªßy b·ªè thao t√°c x√°c nh·∫≠n x√≥a
        function cancelConfirmation() {
            pendingDeleteIndex = -1;
            isDeletingAll = false;
            document.getElementById("confirmModal").style.display = "none"; // ·∫®n modal x√°c nh·∫≠n
        }
        
        // H√†m k·∫øt th√∫c intro (d√π b·∫±ng n√∫t skip hay h·∫øt th·ªùi gian)
        function endIntro() {
            clearTimeout(splashTimer); // X√≥a b·ªô ƒë·∫øm th·ªùi gian n·∫øu c√≥
            const splashScreen = document.getElementById("splashScreen");
            const mainContent = document.getElementById("mainContent");
            const myAudio = document.getElementById("myAudio");
            
            splashScreen.style.display = "none"; // ·∫®n ho√†n to√†n splash screen
            mainContent.style.visibility = "visible";
            mainContent.style.display = "flex";
            mainContent.classList.add("visible");
            
            // Sau khi splash screen ·∫©n, c·ªë g·∫Øng ph√°t nh·∫°c n·∫øu ch∆∞a ph√°t v√† kh√¥ng b·ªã t·∫Øt ti·∫øng
            // Tr√¨nh duy·ªát y√™u c·∫ßu t∆∞∆°ng t√°c ng∆∞·ªùi d√πng ƒë·ªÉ ph√°t media
            if (!audioPlayedFirstTime && !myAudio.muted) {
                 myAudio.play().catch(error => {
                     console.log("L·ªói khi ph√°t nh·∫°c n·ªÅn t·ª± ƒë·ªông (c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng):", error);
                 });
            }
            audioPlayedFirstTime = true; // ƒê√°nh d·∫•u l√† ƒë√£ c·ªë g·∫Øng ph√°t nh·∫°c
        }
        
        // H√†m cho n√∫t SKIP tr√™n splash screen
        function skipIntro() {
            endIntro(); // Khi nh·∫•n n√∫t skip, c≈©ng g·ªçi endIntro ƒë·ªÉ ·∫©n splash v√† hi·ªÉn th·ªã n·ªôi dung ch√≠nh
            // Sau khi skip, ƒë√¢y ƒë∆∞·ª£c coi l√† m·ªôt t∆∞∆°ng t√°c c·ªßa ng∆∞·ªùi d√πng, n√™n th·ª≠ ph√°t nh·∫°c
            const myAudio = document.getElementById("myAudio");
            if (!audioPlayedFirstTime && !myAudio.muted) {
                myAudio.play().catch(error => {
                    console.log("L·ªói khi ph√°t nh·∫°c sau Skip (c√≥ th·ªÉ do ƒë√£ ch·∫°y ·ªü endIntro ho·∫∑c ch√≠nh s√°ch tr√¨nh duy·ªát):", error);
                });
                audioPlayedFirstTime = true;
            }
        }

        // L·∫Øng nghe s·ª± ki·ªán DOMContentLoaded ƒë·ªÉ ƒë·∫£m b·∫£o HTML ƒë√£ t·∫£i xong
        document.addEventListener("DOMContentLoaded", () => {
            const myAudio = document.getElementById("myAudio");
            const toggleSoundCheckbox = document.getElementById("toggleSound");
            const comNgonAudio = document.getElementById("com-ngon"); // L·∫•y c√°c ph·∫ßn t·ª≠ audio m·ªõi
            const giaoHuongAudio = document.getElementById("giao-huong");

            document.getElementById("typeSound").volume = 0.2; // ƒê·∫∑t √¢m l∆∞·ª£ng cho √¢m thanh g√µ
            // ƒê·∫∑t √¢m l∆∞·ª£ng cho c√°c b·∫£n nh·∫°c m·ªõi (c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh)
            comNgonAudio.volume = 0.5;
            giaoHuongAudio.volume = 0.5;

            // T·∫£i tr·∫°ng th√°i t·∫Øt ti·∫øng ƒë√£ l∆∞u t·ª´ LocalStorage
            const savedMuteState = localStorage.getItem("doraemonSoundMuted");
            if (savedMuteState === "true") {
                toggleSoundCheckbox.checked = true;
                myAudio.muted = true;
                document.getElementById("typeSound").muted = true;
                comNgonAudio.muted = true;
                giaoHuongAudio.muted = true;
            } else {
                toggleSoundCheckbox.checked = false;
                myAudio.muted = false;
                document.getElementById("typeSound").muted = false;
                comNgonAudio.muted = false;
                giaoHuongAudio.muted = false;
            }
            
            // T·ªïng th·ªùi gian c·ªßa t·∫•t c·∫£ c√°c animation splash screen l√† 10 gi√¢y (10000 ms)
            // Sau khi t·∫•t c·∫£ c√°c animation ho√†n t·∫•t, g·ªçi h√†m endIntro ƒë·ªÉ ·∫©n splash v√† hi·ªán n·ªôi dung ch√≠nh
            splashTimer = setTimeout(endIntro, 10000);

            // Th√™m event listener cho b·∫•t k·ª≥ t∆∞∆°ng t√°c n√†o tr√™n t√†i li·ªáu (click/tap)
            // S·ª± ki·ªán n√†y gi√∫p ph√°t nh·∫°c n·ªÅn n·∫øu tr√¨nh duy·ªát y√™u c·∫ßu t∆∞∆°ng t√°c ng∆∞·ªùi d√πng
            document.body.addEventListener('click', function firstInteractionPlay() {
                const myAudio = document.getElementById("myAudio");
                // Ch·ªâ ph√°t n·∫øu ch∆∞a ph√°t l·∫ßn n√†o v√† kh√¥ng b·ªã t·∫Øt ti·∫øng
                if (!audioPlayedFirstTime && !myAudio.muted) {
                    myAudio.play().then(() => {
                        audioPlayedFirstTime = true; // ƒê√°nh d·∫•u ƒë√£ ph√°t th√†nh c√¥ng
                        document.body.removeEventListener('click', firstInteractionPlay); // G·ª° b·ªè listener sau khi ph√°t
                    }).catch(error => {
                        console.log("L·ªói khi ph√°t nh·∫°c n·ªÅn sau t∆∞∆°ng t√°c ƒë·∫ßu ti√™n:", error);
                        // C√≥ th·ªÉ th√™m m·ªôt n√∫t "B·∫≠t nh·∫°c" nh·ªè n·∫øu mu·ªën ng∆∞·ªùi d√πng k√≠ch ho·∫°t th·ªß c√¥ng
                    });
                }
            }, { once: true }); // D√πng once: true ƒë·ªÉ ch·ªâ nghe s·ª± ki·ªán n√†y m·ªôt l·∫ßn

            // G·∫Øn l·∫°i s·ª± ki·ªán l·∫Øng nghe click to√†n b·ªô document, ƒë·∫£m b·∫£o n√≥ lu√¥n ho·∫°t ƒë·ªông
            document.addEventListener("click", function(e) {
                const panel = document.getElementById("settingsPanel");
                const toggle = document.querySelector(".settings-toggle");
                const modalLichSu = document.getElementById("modalLichSu");
                const confirmModal = document.getElementById("confirmModal");

                // Logic ƒë√≥ng settings panel khi click ra ngo√†i, tr√°nh ƒë√≥ng khi click v√†o c√°c modal
                if (panel.style.display === "flex" &&
                    !panel.contains(e.target) &&
                    !toggle.contains(e.target) &&
                    !modalLichSu.contains(e.target) && // Lo·∫°i tr·ª´ modal l·ªãch s·ª≠
                    !confirmModal.contains(e.target)) { // Lo·∫°i tr·ª´ modal x√°c nh·∫≠n
                    panel.style.display = "none";
                    toggle.classList.remove("rotate");
                    toggle.classList.add("rotate-back");
                }
            }, { once: false });
        });
        // G·∫Øn s·ª± ki·ªán change cho checkbox t·∫Øt/b·∫≠t √¢m thanh
        document.getElementById("toggleSound").addEventListener("change", toggleAudio);
    </script>
</body>
</html>
